<html>
	<head>
		<title>MoarTube</title>
		<link rel="icon" type="image/x-icon" href="/external/resources/images/favicon.ico">
		<link href="/external/resources/css/videojs-8.6.1.css" rel="stylesheet" type="text/css"/>
		<link href="/external/resources/css/videojs-theme.css" rel="stylesheet" type="text/css"/>
		<link href="/external/resources/css/bootstrap.min-5.3.0.css" rel="stylesheet" type="text/css"/>
		<script src="/external/resources/javascript/jquery-3.6.4.min.js"></script>
		<script src="/external/resources/javascript/videojs-8.6.1.js"></script>
		<script src="/external/resources/javascript/videojs-landscape-fullscreen.min.js"></script>
		<script src="/external/resources/javascript/bootstrap-5.3.0.min.js"></script>
		<style>
			body {
				font-family: Arial, sans-serif;
				margin: 0;
				padding: 0;
			}

			#recommended-videos {
				margin-left: 20px;
			}
			
			#video-information-container span {
				color: #606060;
			}
			
			.img-fluid {
				width: 100%;
			}
			
			textarea { 
				outline: none;
			}
			
			.btn-primary {
				--bs-btn-color: #fff;
				--bs-btn-bg: #cb0c9f;
				--bs-btn-border-color: #cb0c9f;
				--bs-btn-hover-color: #fff;
				--bs-btn-hover-bg: #cb0c9f;
				--bs-btn-hover-border-color: #cb0c9f;
				--bs-btn-focus-shadow-rgb: 49,132,253;
				--bs-btn-active-color: #cb0c9f;
				--bs-btn-active-bg: white;
				--bs-btn-active-border-color: #cb0c9f;
				--bs-btn-active-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
				--bs-btn-disabled-color: #fff;
				--bs-btn-disabled-bg: #cb0c9f;
				--bs-btn-disabled-border-color: #cb0c9f;
			}
			
			.btn-outline-primary {
				--bs-btn-color: #cb0c9f;
				--bs-btn-border-color: #cb0c9f;
				--bs-btn-hover-color: #cb0c9f;
				--bs-btn-hover-bg: #cb0c9f;
				--bs-btn-hover-border-color: #cb0c9f;
				--bs-btn-focus-shadow-rgb: 13,110,253;
				--bs-btn-active-color: #fff;
				--bs-btn-active-bg: #cb0c9f;
				--bs-btn-active-border-color: #cb0c9f;
				--bs-btn-active-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
				--bs-btn-disabled-color: #cb0c9f;
				--bs-btn-disabled-bg: transparent;
				--bs-btn-disabled-border-color: #cb0c9f;
				--bs-gradient: none;
			}
			
			.btn.recommendation-category-button.active, .btn.recommendation-category-button:first-child:active {
				--bs-btn-active-color: #cb0c9f;
				--bs-btn-active-bg: white;
			}

			.btn.recommendation-category-button-selected.active, .btn.recommendation-category-button-selected:first-child:active {
				--bs-btn-active-color: #fff;
				--bs-btn-active-bg: #cb0c9f;
			}
		
			.btn.recommendation-category-button-selected {
				--bs-btn-color: #fff;
				--bs-btn-bg: #cb0c9f;
				--bs-btn-border-color: #cb0c9f;
				--bs-btn-hover-color: #fff;
				--bs-btn-hover-bg: #cb0c9f;
				--bs-btn-hover-border-color: #cb0c9f;
				--bs-btn-focus-shadow-rgb: 49,132,253;
				--bs-btn-active-color: #cb0c9f;
				--bs-btn-active-bg: white;
				--bs-btn-active-border-color: #cb0c9f;
				--bs-btn-active-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
				--bs-btn-disabled-color: #fff;
				--bs-btn-disabled-bg: #cb0c9f;
				--bs-btn-disabled-border-color: #cb0c9f;
			}
			
			.btn-outline-primary:hover {
				background-color: inherit;
				text-decoration: none;
			}
		
			.btn.recommendation-category-button-selected:hover {
				background-color: #cb0c9f;
			}
					
			.btn.recommendation-category-button-selected:hover {
				color: white;
			}
					
			.btn.recommendation-category-button {
				font-size: 13px;
			}
					
			#overflow-dropdown-button.show:hover {
				background-color: #cb0c9f;
			}
			
			div.reply {
				background-color: white;
				border: 1px solid #b7c5d9;
				border-left: none;
				border-bottom: none;
				border-right: none;
				display: table;
				padding: 2px;
			}
			
			div.post {
				width: 100%;
				overflow: hidden;
			}

			div.post div.postInfo {
				display: block;
				width: 100%;
			}

			div.post div.postInfo span.nameBlock {
				display: inline-block;
			}

			div.post div.postInfo span.nameBlock span.name {
				color: #cb0c9f;
				font-weight: 700;
			}

			.posteruid .hand {
				padding: 0 5px;
				border-radius: 6px;
				font-size: 0.8em;
			}

			div.post div.postInfo span.postNum a {
				text-decoration: none;
				color: #000;
			}

			.postMenuBtn {
				margin-left: 5px;
				text-decoration: none;
				line-height: 1em;
				display: inline-block;
				-webkit-transition: -webkit-transform 0.1s;
				-moz-transition: -moz-transform 0.1s;
				transition: transform 0.1s;
				width: 1em;
				height: 1em;
				text-align: center;
				outline: none;
				opacity: 0.8;
			}

			div.backlink {
				font-size: 0.8em !important;
				display: inline;
				padding: 0;
				padding-left: 5px;
			}

			.backlink span {
				padding: 0;
			}

			.burichan_new .backlink a, .yotsuba_b_new .backlink a {
				color: #34345C !important;
			}

			.quoteLink, .deadlink {
				color: #d00!important;
			}

			.quoteLink {
				text-decoration: underline;
			}

			.deadlink {
				text-decoration: line-through;
			}

			div.post blockquote.postMessage {
				display: block;
			}

			blockquote {
				display: block;
				margin-block-start: 1em;
				margin-block-end: 1em;
				margin-inline-start: 40px;
				margin-inline-end: 40px;
			}

			blockquote>span.quote {
				color: #789922;
			}

			.reply:target, .reply.highlight {
				background: #ede3eb!important;
				border: 1px solid #ba9dbf!important;
				border-left: none!important;
				border-bottom: none!important;
				padding: 2px;
			}

			.reply.highlight-anti {
				border-width: 1px !important;
				background-color: #bfa6ba !important;
			}

			#quote-preview .reply.highlight {
				border-left: 1px solid #ba9dbf!important;
				border-bottom: 1px solid #ba9dbf!important;
			}
			
			.mobile, .mobileinline, .mobileib {
				display: none!important;
			}

			.posteruid .hand {
				padding: 0 5px;
				border-radius: 6px;
				font-size: 0.8em;
			}
			.hand {
				cursor: pointer;
			}
			
			.list-group-item {
				padding: 0px;
			}
			
			.swal2-input {
				padding: 0.5rem 0.75rem;
				font-size: .875rem;
				font-weight: 400;
				line-height: 1.4rem;
				color: #495057;
				background-color: #fff;
				background-clip: padding-box;
				border: 1px solid #d2d6da;
			}

			.swal2-input {
				margin: 0;
				width: 100%;
			}

			.swal2-textarea {
				margin: 0;
				width: 100%;
			}

			.swal2-styled.swal2-confirm {
				border: 0;
				border-radius: 0.25em;
				background: initial;
				background-color: #7367f0;
				color: #fff;
				font-size: 1em;
			}
			.swal2-styled.swal2-confirm {
				background-image: linear-gradient(310deg,#7928ca,#ff0080);
				background-color: transparent;
				--bs-btn-padding-y: 0.75rem;
				--bs-btn-padding-x: 1.5rem;
				--bs-btn-font-size: 0.75rem;
				--bs-btn-border-radius: 0.5rem
			}

			.swal2-styled.swal2-confirm:focus,.swal2-styled.swal2-confirm:hover {
				background-image: linear-gradient(130deg,#7928ca,#ff0080)!important;
				outline: 0;
				box-shadow: 0 3px 5px -1px rgba(0,0,0,.09),0 2px 3px -1px rgba(0,0,0,.07)
			}
			.form-control:focus {
				border-left: 1px solid #e293d3!important;
				border-right: 1px solid #e293d3!important
			}

			.form-control:focus {
				color: #495057;
				background-color: #fff;
				border-color: #e293d3;
				outline: 0;
				box-shadow: 0 0 0 2px #e9aede
			}

			.keen-slider:not([data-keen-slider-disabled]) .keen-slider__slide {
				overflow: visible;
				width: auto;
			}

			.video-player-theater-mode {
				width: 100%;
				max-height: calc(100vh - 10vh) !important;
				position: unset;
			}

			.video-player-dimensions.vjs-fluid:not(.vjs-audio-only-mode) {
				padding-top: calc(100vh - 10vh) !important
			}

			@media (min-width: 0px) {
				.container-fluid {
					width: 100%;
				}
				
				#comment-section {
					display: none;
				}
				
				#expand-comment-section {
					display: block;
				}
				
				#navbar-responsive-node-avatar {
					display: block;
				}
				
				#navbar-list-node-avatar {
					display: none;
				}
				
				.shaka-theater-button, .video-js-theater-button {
					display: none !important;
				}
			}

			@media (min-width: 1200px) {
				.container-fluid {
					width: 70%;
				}
				
				#comment-section {
					display: block;
				}
				
				#expand-comment-section {
					display: none;
				}
				
				#navbar-responsive-node-avatar {
					display: none;
				}
				
				#navbar-list-node-avatar {
					display: block;
				}
				
				.shaka-theater-button, .video-js-theater-button {
					display: inline-block !important;
				}
			}

			.text-primary {
				color: #cb0c9f!important;
			}

			.hidden-elem {
				display: none !important;
			}
			
			.vjs-big-play-button {
				display: none !important;
			}
			
			.shaka-controls-container {
				display: none !important;
			}
			
			
			
			
			
			

			
			
			
			
			.mtp-large-play-button {
				position: absolute;
				width: 68px;
				height: 48px;
				margin-left: -34px;
				margin-top: -24px;
				left: 50%;
				top: 50%;
				fill: #cb0c9f;
				fill-opacity: 1;
				-webkit-transition: opacity .25s cubic-bezier(0,0,.2,1);
				-o-transition: opacity .25s cubic-bezier(0,0,.2,1);
				transition: opacity .25s cubic-bezier(0,0,.2,1);
				z-index: 1;
			}
			
			.mtp-large-play-button svg {
				pointer-events: none;
				position: absolute;
				width: 100%;
				height: 100%;
				top: 0;
				left: 0;
			}

			.mtp-button {
				border: none;
				background-color: transparent;
				padding: 0;
				color: inherit;
				text-align: inherit;
				font-size: 100%;
				font-family: inherit;
				cursor: default;
				line-height: inherit;
			}
			
			#mtp-video-overlay-info {
				z-index: 9
			}
			
			#mtp-video-title {
				color: white;
				font-size: 18px;
			}
			
			.mpt-video-icon {
				border-radius: 50%;
			}
			
			
			.mtp-video-overlay-info-fade-out {
				opacity: 0.0 !important;
				transition: opacity 0.6s ease-in-out;
				-moz-transition: opacity 0.6s ease-in-out;
				-webkit-transition: opacity 0.6s ease-in-out;
			}
			
			.mtp-video-overlay-info-fade-in {
				opacity: 1.0 !important;
				transition: opacity 0.6s ease-in-out;
				-moz-transition: opacity 0.6s ease-in-out;
				-webkit-transition: opacity 0.6s ease-in-out;
			}â€‹
			
			.vjs-big-play-button  {
				display: none !important;
			}
			
			.shaka-play-button {
				display: none !important;
			}

			.vjs-fullscreen-control {
				order: 9;
			}
		</style>
	</head>
	<body class="overflow-hidden">
		<div id="video-comments-inner">
			<div id="video-player-container" class="ratio ratio-16x9" style="background: black; color: white;">
				<div id="mtp-video-overlay-info" class="p-2 d-flex align-items-center mtp-video-overlay-info-fade-out" style="height:auto;background:#0000007a;">
					<a id="mtp-channel-link" class="text-decoration-none me-2" href="/" target="_blank">
						<img class="mpt-video-icon" src="/external/resources/images/icon.png">
					</a>
					<a id="mtp-video-link" class="text-decoration-none text-truncate" target="_blank" style="max-width: 100%;">
						<div id="mtp-video-title" class="d-inline-block"></div>
					</a>
				</div>
				<div id="mtp-video-overlay" class="ratio ratio-16x9" style="position: absolute; z-index: 1;width: 100%;" role="button">
					<div class="mtp-video-overlay-child ratio ratio-16x9">
						<button class="mtp-button mtp-large-play-button">
							<svg version="1.1" viewBox="0 0 68 48" width="100%" height="100%">
								<path d="M66.52,7.74c-0.78-2.93-2.49-5.41-5.42-6.19C55.79,.13,34,0,34,0S12.21,.13,6.9,1.55 C3.97,2.33,2.27,4.81,1.48,7.74C0.06,13.05,0,24,0,24s0.06,10.95,1.48,16.26c0.78,2.93,2.49,5.41,5.42,6.19 C12.21,47.87,34,48,34,48s21.79-0.13,27.1-1.55c2.93-0.78,4.64-3.26,5.42-6.19C67.94,34.95,68,24,68,24S67.94,13.05,66.52,7.74z" fill="#cb0c9f"></path>
								<path d="M 51.908 24 L 33.908 14 L 33.908 34" fill="#fff"></path>
								<path d="M 37.342 24.211 L 19.342 14.211 L 19.342 34.211" fill="#fff"></path>
							</svg>
						</button>
						<img id="video-poster" />
					</div>
					<div class="mtp-video-overlay-child">
						<a id="watch-on-moartube-mtp-overlay-child" class="text-white" target="_blank"><div class="p-2" style="position: absolute; bottom: 0px; background-color: rgba(23,23,23,.8);">Watch on <svg viewBox="169.022 81.466 89.186 20.228" xmlns="http://www.w3.org/2000/svg" style="width: 90px; height: 20px;">
								<g transform="matrix(1, 0, 0, 1, 169.021713, 81.694077)">
								<path d="M27.9727 3.12324C27.6435 1.89323 26.6768 0.926623 25.4468 0.597366C23.2197 2.24288e-07 14.285 0 14.285 0C14.285 0 5.35042 2.24288e-07 3.12323 0.597366C1.89323 0.926623 0.926623 1.89323 0.597366 3.12324C2.24288e-07 5.35042 0 10 0 10C0 10 2.24288e-07 14.6496 0.597366 16.8768C0.926623 18.1068 1.89323 19.0734 3.12323 19.4026C5.35042 20 14.285 20 14.285 20C14.285 20 23.2197 20 25.4468 19.4026C26.6768 19.0734 27.6435 18.1068 27.9727 16.8768C28.5701 14.6496 28.5701 10 28.5701 10C28.5701 10 28.5677 5.35042 27.9727 3.12324Z" fill="#cb0c9f"></path>
								<path d="M 14.425 14.285 L 21.848 10 L 14.425 5.715 L 14.425 14.285 Z" fill="white"></path>
								<path d="M 8.425 14.285 L 15.848 10 L 8.425 5.715 L 8.425 14.285 Z" fill="white"></path>
								</g>
								<path d="M 204.012 71.432 L 204.012 60.552 L 207.3 60.552 L 209.274 67.973 L 211.226 60.552 L 214.522 60.552 L 214.522 71.432 L 212.481 71.432 L 212.481 62.867 L 210.321 71.432 L 208.206 71.432 L 206.053 62.867 L 206.053 71.432 Z M 215.202 67.38 Q 215.202 66.341 215.714 65.368 Q 216.226 64.396 217.165 63.884 Q 218.104 63.372 219.262 63.372 Q 221.05 63.372 222.193 64.533 Q 223.336 65.695 223.336 67.469 Q 223.336 69.257 222.182 70.434 Q 221.028 71.61 219.276 71.61 Q 218.193 71.61 217.209 71.12 Q 216.226 70.63 215.714 69.684 Q 215.202 68.738 215.202 67.38 Z M 217.339 67.491 Q 217.339 68.664 217.896 69.287 Q 218.453 69.911 219.269 69.911 Q 220.085 69.911 220.638 69.287 Q 221.191 68.664 221.191 67.476 Q 221.191 66.318 220.638 65.695 Q 220.085 65.071 219.269 65.071 Q 218.453 65.071 217.896 65.695 Q 217.339 66.318 217.339 67.491 Z M 225.529 65.955 L 223.636 65.613 Q 223.955 64.47 224.735 63.921 Q 225.514 63.372 227.05 63.372 Q 228.446 63.372 229.128 63.702 Q 229.811 64.032 230.09 64.541 Q 230.368 65.049 230.368 66.407 L 230.346 68.842 Q 230.346 69.881 230.446 70.374 Q 230.546 70.868 230.821 71.432 L 228.757 71.432 Q 228.676 71.224 228.557 70.816 Q 228.505 70.63 228.483 70.571 Q 227.948 71.091 227.34 71.35 Q 226.731 71.61 226.041 71.61 Q 224.824 71.61 224.122 70.95 Q 223.421 70.289 223.421 69.28 Q 223.421 68.612 223.74 68.088 Q 224.059 67.565 224.634 67.287 Q 225.21 67.009 226.293 66.801 Q 227.755 66.526 228.319 66.289 L 228.319 66.081 Q 228.319 65.48 228.023 65.224 Q 227.726 64.968 226.902 64.968 Q 226.345 64.968 226.033 65.186 Q 225.722 65.405 225.529 65.955 Z M 228.319 67.647 Q 227.919 67.78 227.05 67.966 Q 226.182 68.152 225.915 68.33 Q 225.507 68.619 225.507 69.064 Q 225.507 69.502 225.833 69.821 Q 226.16 70.141 226.664 70.141 Q 227.228 70.141 227.741 69.769 Q 228.119 69.487 228.238 69.079 Q 228.319 68.812 228.319 68.062 Z M 233.418 71.432 L 231.333 71.432 L 231.333 63.55 L 233.27 63.55 L 233.27 64.671 Q 233.767 63.877 234.164 63.624 Q 234.561 63.372 235.066 63.372 Q 235.779 63.372 236.439 63.765 L 235.793 65.584 Q 235.266 65.242 234.814 65.242 Q 234.376 65.242 234.071 65.483 Q 233.767 65.725 233.593 66.355 Q 233.418 66.986 233.418 68.998 Z M 238.801 71.432 L 238.801 62.392 L 235.572 62.392 L 235.572 60.552 L 244.219 60.552 L 244.219 62.392 L 240.998 62.392 L 240.998 71.432 Z M 248.679 71.432 L 248.679 70.252 Q 248.249 70.883 247.547 71.246 Q 246.846 71.61 246.067 71.61 Q 245.272 71.61 244.642 71.261 Q 244.011 70.912 243.729 70.282 Q 243.447 69.651 243.447 68.537 L 243.447 63.55 L 245.532 63.55 L 245.532 67.172 Q 245.532 68.834 245.647 69.209 Q 245.762 69.584 246.067 69.803 Q 246.371 70.022 246.838 70.022 Q 247.373 70.022 247.796 69.729 Q 248.219 69.436 248.375 69.001 Q 248.531 68.567 248.531 66.875 L 248.531 63.55 L 250.616 63.55 L 250.616 71.432 Z M 251.685 71.432 L 251.685 60.552 L 253.77 60.552 L 253.77 64.47 Q 254.735 63.372 256.056 63.372 Q 257.496 63.372 258.439 64.415 Q 259.381 65.457 259.381 67.409 Q 259.381 69.428 258.42 70.519 Q 257.459 71.61 256.086 71.61 Q 255.411 71.61 254.754 71.272 Q 254.097 70.935 253.622 70.274 L 253.622 71.432 Z M 253.755 67.32 Q 253.755 68.545 254.141 69.131 Q 254.683 69.962 255.581 69.962 Q 256.271 69.962 256.758 69.372 Q 257.244 68.782 257.244 67.513 Q 257.244 66.162 256.754 65.565 Q 256.264 64.968 255.5 64.968 Q 254.75 64.968 254.253 65.55 Q 253.755 66.133 253.755 67.32 Z M 264.621 68.923 L 266.699 69.272 Q 266.298 70.415 265.434 71.013 Q 264.569 71.61 263.27 71.61 Q 261.214 71.61 260.227 70.267 Q 259.448 69.191 259.448 67.55 Q 259.448 65.591 260.472 64.481 Q 261.496 63.372 263.062 63.372 Q 264.821 63.372 265.838 64.533 Q 266.855 65.695 266.81 68.092 L 261.585 68.092 Q 261.608 69.02 262.09 69.536 Q 262.572 70.052 263.292 70.052 Q 263.782 70.052 264.116 69.784 Q 264.45 69.517 264.621 68.923 Z M 264.74 66.816 Q 264.717 65.91 264.272 65.439 Q 263.827 64.968 263.188 64.968 Q 262.506 64.968 262.06 65.465 Q 261.615 65.962 261.622 66.816 Z" transform="matrix(0.915771, 0, 0, 1.777663, 13.868996, -26.174692)" style="white-space: pre;" fill="white"></path>
								</svg>
							</div>
						</a>
					</div>
				</div>
				<video id="video-player" class="video-js video-player" preload="auto" autoplay></video>
			</div>
		</div>
		<script>
            const INCOMING_PARAMETERS = [[= JSON.stringify(model) ]];

			let VIDEO_ID;
			let AUTO_START;

			let CURRENT_VIDEO_RESOLUTION;
			let CURRENT_VIDEO_FORMAT;

			$(document).ready(function() {
				const embeddedValue = window.location.pathname.split('/');

				if(embeddedValue.length === 5) {
					VIDEO_ID = embeddedValue[4];
					
					if(VIDEO_ID != null) {
						const params = new URL(window.location.href).searchParams;

						AUTO_START = Number(params.get('autostart')) === 1 ? true : false;

						loadVideo(INCOMING_PARAMETERS.videoData.video);
					}
				}
			});
			
			function loadVideo(video) {
				const nodeName = video.nodeName;
				
				const title = video.title;
				const description = video.description;
				const views = video.views;
				const isPublishing = video.isPublishing;
				const isPublished = video.isPublished;
				const isLive = video.isLive;
				const isStreaming = video.isStreaming;
				const isStreamed = video.isStreamed;
				const comments = video.comments;
				const creationTimestamp = video.creationTimestamp;
				
				const adaptiveSources = video.adaptiveSources;
				const progressiveSources = video.progressiveSources;
				const sourcesFormatsAndResolutions = video.sourcesFormatsAndResolutions;
				
				document.title = title + ' - MoarTube';
				
				if(isLive) {
					if(isStreaming) {
						$('#mtp-video-overlay').prepend('<span id="live-stream-indicator" class="d-sm-inline"><i class="bi bi-broadcast" style="position: absolute;right: 5px;bottom: 5px;background-color: #cb0c9f;color: white;border-radius: 4px;padding: 3px;font-size: 10px;font-weight: 500;z-index: 9;"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-broadcast" viewBox="0 0 16 16"><path d="M3.05 3.05a7 7 0 0 0 0 9.9.5.5 0 0 1-.707.707 8 8 0 0 1 0-11.314.5.5 0 0 1 .707.707zm2.122 2.122a4 4 0 0 0 0 5.656.5.5 0 1 1-.708.708 5 5 0 0 1 0-7.072.5.5 0 0 1 .708.708zm5.656-.708a.5.5 0 0 1 .708 0 5 5 0 0 1 0 7.072.5.5 0 1 1-.708-.708 4 4 0 0 0 0-5.656.5.5 0 0 1 0-.708zm2.122-2.12a.5.5 0 0 1 .707 0 8 8 0 0 1 0 11.313.5.5 0 0 1-.707-.707 7 7 0 0 0 0-9.9.5.5 0 0 1 0-.707zM10 8a2 2 0 1 1-4 0 2 2 0 0 1 4 0z"></path></svg>&nbsp;LIVE</i></span>');
					}
					else {
						$('#mtp-video-overlay').prepend('<span id="live-stream-indicator" class="d-sm-inline"><i class="" style="position: absolute;right: 5px;bottom: 5px;background-color: #cb0c9f;color: white;border-radius: 4px;padding: 3px;font-size: 10px;font-weight: 500;z-index: 9;">&nbsp;STREAMED</i></span>');
					}
				}
				
				$('#mtp-video-title').html(title);

				let message = '';

				if(adaptiveSources.length > 0 || progressiveSources.length > 0) {
					if(isPublished || isStreaming) {
						initializeVideoJsPlayer();
					}
					else if(isStreamed) {
						message = 'this live stream has ended and has not been published';
					}
					else {
						message = 'this video is unavailable';
					}
				}
				else {
					if(isPublishing) {
						message = 'this video is currently publishing, please check back later';
					}
					else if(isStreaming) {
						message = 'this live stream has not started yet';
					}
					else if(isStreamed) {
						message = 'this live stream has ended and has not been published';
					}
					else {
						message = 'this video is unavailable';
					}
				}

				if(message != '') {
					$('#mtp-video-overlay').remove();
					$('#video-player-container').append('<div class="d-flex align-items-center justify-content-center">' + message + '</div>');
				}
				
				function initializeVideoJsPlayer() {
					window.videojs.log.level("off");
					
					$('#mtp-video-link').attr('href', '/watch?v=' + VIDEO_ID);
					$('#watch-on-moartube-mtp-overlay-child').attr('href', '/watch?v=' + VIDEO_ID);

					$('#video-poster').attr('src', '/external/videos/' + VIDEO_ID + '/poster');

					$("#video-player").attr("controls", true);

					const sources = adaptiveSources.concat(progressiveSources);

					let player = videojs('video-player', {
						html5: {
							vhs: {
								overrideNative: !videojs.browser.IS_SAFARI,
								llhls:true
							},
							nativeAudioTracks: false,
							nativeVideoTracks: false
						},
						liveui: true, 
						errorDisplay: false, 
						liveTracker: { 
							trackingThreshold: 0 
						}, 
						preload: "auto", 
						disablePictureInPicture: true, 
						controlBar: { 
							pictureInPictureToggle: false 
						}
					});

					player.landscapeFullscreen();

					configurePlayerButtons();
					configurePlayerEvents();
					configurePlayerContextMenu();

					if(AUTO_START) {
						player.src(sources);
						player.play()
						.then(function() {
						
						})
						.catch(function(error) {
							console.log(error);
						});
					}

					function configurePlayerButtons() {
						const handleTechClickDefaultFunction = player.player_.handleTechClick_;

						const MATERIAL_NAVIGATE_NEXT_SVG = '<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="M504-480 320-664l56-56 240 240-240 240-56-56 184-184Z" fill="#fff"/></svg>';
						const MATERIAL_NAVIGATE_BEFORE_SVG = '<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="M560-240 320-480l240-240 56 56-184 184 184 184-56 56Z" fill="#fff"/></svg>';
						const MATERIAL_DONE_SVG = '<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="M382-240 154-468l57-57 171 171 367-367 57 57-424 424Z" fill="#fff"/></svg>';
						
						// overflow button
						const overflowButton = player.getChild('ControlBar').addChild('button', {
							clickHandler: function(event) {
								event[0].stopPropagation();
								
								if($('#video-player .vjs-control-bar .video-js-overflow-menu').length === 0) {
									player.player_.handleTechClick_ = function(event) {}
									
									$('body').on('click', function(event) {
										$('body').off('click');
										
										$('.video-player .vjs-control-bar .video-js-overflow-menu').remove();
										
										player.player_.handleTechClick_ = handleTechClickDefaultFunction;
									});
									
									showVideoJsOverflowMenuHtml(player);
								}
								else {
									removeOverflowMenuHtml();
									
									player.player_.handleTechClick_ = handleTechClickDefaultFunction;
								}
							}
						});
						overflowButton.el().innerHTML = '<svg viewBox="0 -960 960 960" height="24" width="100%"><path d="M480-160q-33 0-56.5-23.5T400-240q0-33 23.5-56.5T480-320q33 0 56.5 23.5T560-240q0 33-23.5 56.5T480-160Zm0-240q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm0-240q-33 0-56.5-23.5T400-720q0-33 23.5-56.5T480-800q33 0 56.5 23.5T560-720q0 33-23.5 56.5T480-640Z" fill="#fff"/></svg>';
						overflowButton.el().style.order = "10";
						overflowButton.el().style.cursor = "pointer";

						// watch on moartube controlbar button
						const websiteButton = player.getChild('ControlBar').addChild('button', {
							clickHandler: function(event) {
								player.pause();
							}
						});

						websiteButton.el().innerHTML = '<a href="/watch?v=' + VIDEO_ID + '" target="_blank"><svg viewBox="219.612 206.192 57.5107 19.658" height="19.658" width="57.511"><path d="M 219.612 225.533 L 219.612 206.192 L 222.623 206.192 L 224.431 219.384 L 226.218 206.192 L 229.237 206.192 L 229.237 225.533 L 227.368 225.533 L 227.368 210.307 L 225.39 225.533 L 223.453 225.533 L 221.481 210.307 L 221.481 225.533 L 219.612 225.533 Z M 229.859 218.33 C 229.859 217.099 230.016 215.907 230.328 214.753 C 230.641 213.601 231.084 212.722 231.657 212.115 C 232.23 211.509 232.87 211.205 233.577 211.205 C 234.669 211.205 235.564 211.893 236.262 213.269 C 236.959 214.646 237.308 216.386 237.308 218.488 C 237.308 220.607 236.956 222.364 236.251 223.759 C 235.547 225.153 234.66 225.85 233.59 225.85 C 232.929 225.85 232.298 225.559 231.697 224.979 C 231.097 224.398 230.641 223.547 230.328 222.426 C 230.016 221.305 229.859 219.939 229.859 218.33 Z M 231.816 218.527 C 231.816 219.918 231.986 220.982 232.326 221.72 C 232.667 222.46 233.086 222.829 233.584 222.829 C 234.082 222.829 234.5 222.46 234.838 221.72 C 235.175 220.982 235.344 219.909 235.344 218.501 C 235.344 217.128 235.175 216.073 234.838 215.335 C 234.5 214.595 234.082 214.225 233.584 214.225 C 233.086 214.225 232.667 214.595 232.326 215.335 C 231.986 216.073 231.816 217.137 231.816 218.527 Z M 239.317 215.797 L 237.583 215.189 C 237.778 213.834 238.113 212.832 238.589 212.181 C 239.065 211.531 239.772 211.205 240.709 211.205 C 241.562 211.205 242.196 211.401 242.612 211.792 C 243.029 212.183 243.323 212.68 243.493 213.283 C 243.663 213.885 243.748 214.991 243.748 216.6 L 243.728 220.929 C 243.728 222.16 243.758 223.068 243.819 223.652 C 243.88 224.238 243.995 224.865 244.163 225.533 L 242.273 225.533 C 242.223 225.287 242.162 224.922 242.09 224.438 C 242.058 224.218 242.035 224.073 242.022 224.003 C 241.695 224.619 241.346 225.08 240.975 225.387 C 240.603 225.696 240.207 225.85 239.785 225.85 C 239.042 225.85 238.457 225.458 238.028 224.676 C 237.6 223.893 237.386 222.903 237.386 221.708 C 237.386 220.916 237.483 220.21 237.678 219.589 C 237.873 218.969 238.146 218.494 238.497 218.165 C 238.849 217.835 239.355 217.547 240.016 217.301 C 240.909 216.975 241.527 216.672 241.872 216.391 L 241.872 216.021 C 241.872 215.309 241.781 214.801 241.6 214.497 C 241.419 214.194 241.077 214.042 240.574 214.042 C 240.234 214.042 239.969 214.172 239.778 214.43 C 239.588 214.689 239.434 215.145 239.317 215.797 Z M 241.872 218.805 C 241.627 218.962 241.24 219.151 240.709 219.372 C 240.18 219.592 239.833 219.808 239.67 220.019 C 239.421 220.361 239.296 220.796 239.296 221.324 C 239.296 221.843 239.396 222.291 239.595 222.669 C 239.795 223.049 240.048 223.238 240.356 223.238 C 240.7 223.238 241.029 223.018 241.342 222.577 C 241.573 222.243 241.725 221.834 241.797 221.35 C 241.847 221.034 241.872 220.431 241.872 219.542 L 241.872 218.805 Z M 246.541 225.533 L 244.632 225.533 L 244.632 211.522 L 246.406 211.522 L 246.406 213.514 C 246.709 212.573 246.982 211.953 247.224 211.653 C 247.467 211.355 247.742 211.205 248.05 211.205 C 248.486 211.205 248.905 211.438 249.308 211.904 L 248.716 215.137 C 248.394 214.732 248.095 214.529 247.819 214.529 C 247.552 214.529 247.325 214.672 247.139 214.958 C 246.953 215.245 246.808 215.761 246.701 216.508 C 246.594 217.256 246.541 218.822 246.541 221.206 L 246.541 225.533 Z M 251.471 225.533 L 251.471 209.463 L 248.514 209.463 L 248.514 206.192 L 256.432 206.192 L 256.432 209.463 L 253.483 209.463 L 253.483 225.533 L 251.471 225.533 Z M 260.517 225.533 L 260.517 223.436 C 260.254 224.183 259.909 224.772 259.48 225.203 C 259.052 225.634 258.6 225.85 258.125 225.85 C 257.639 225.85 257.204 225.643 256.82 225.229 C 256.434 224.816 256.156 224.235 255.984 223.489 C 255.811 222.741 255.725 221.707 255.725 220.387 L 255.725 211.522 L 257.635 211.522 L 257.635 217.96 C 257.635 219.93 257.67 221.137 257.74 221.581 C 257.81 222.026 257.938 222.378 258.125 222.637 C 258.31 222.897 258.546 223.027 258.831 223.027 C 259.157 223.027 259.45 222.853 259.708 222.506 C 259.966 222.159 260.143 221.727 260.238 221.212 C 260.334 220.697 260.381 219.438 260.381 217.432 L 260.381 211.522 L 262.291 211.522 L 262.291 225.533 L 260.517 225.533 Z M 263.269 225.533 L 263.269 206.192 L 265.179 206.192 L 265.179 213.157 C 265.768 211.856 266.466 211.205 267.272 211.205 C 268.151 211.205 268.879 211.823 269.455 213.059 C 270.03 214.294 270.317 216.068 270.317 218.382 C 270.317 220.774 270.024 222.617 269.437 223.91 C 268.85 225.203 268.138 225.85 267.3 225.85 C 266.888 225.85 266.481 225.649 266.08 225.249 C 265.679 224.849 265.333 224.258 265.043 223.475 L 265.043 225.533 L 263.269 225.533 Z M 265.165 218.223 C 265.165 219.675 265.283 220.748 265.519 221.443 C 265.849 222.428 266.289 222.92 266.837 222.92 C 267.259 222.92 267.618 222.57 267.915 221.871 C 268.212 221.172 268.36 220.07 268.36 218.566 C 268.36 216.965 268.211 215.811 267.912 215.104 C 267.612 214.396 267.23 214.042 266.763 214.042 C 266.305 214.042 265.925 214.387 265.621 215.077 C 265.317 215.768 265.165 216.817 265.165 218.223 Z M 275.116 221.073 L 277.019 221.693 C 276.774 223.048 276.388 224.08 275.86 224.788 C 275.332 225.496 274.672 225.85 273.879 225.85 C 272.623 225.85 271.695 225.054 271.092 223.462 C 270.616 222.187 270.379 220.577 270.379 218.632 C 270.379 216.311 270.691 214.492 271.316 213.177 C 271.942 211.862 272.732 211.205 273.688 211.205 C 274.762 211.205 275.609 211.893 276.23 213.269 C 276.851 214.646 277.148 216.755 277.121 219.596 L 272.336 219.596 C 272.35 220.696 272.504 221.551 272.798 222.163 C 273.092 222.774 273.459 223.08 273.899 223.08 C 274.198 223.08 274.45 222.921 274.653 222.604 C 274.857 222.287 275.011 221.777 275.116 221.073 Z M 275.225 217.327 C 275.211 216.254 275.068 215.438 274.796 214.88 C 274.525 214.321 274.194 214.042 273.804 214.042 C 273.387 214.042 273.043 214.337 272.771 214.926 C 272.499 215.515 272.365 216.315 272.369 217.327 L 275.225 217.327 Z" style="fill: rgb(255, 255, 255); white-space: pre;"/></svg></a>';
						websiteButton.el().style.order = "8";
						websiteButton.el().style.cursor = "pointer";
						websiteButton.el().style['margin-right'] = "35px";
						
						function showVideoJsOverflowMenuHtml(player) {
							const currentPlaybackRate = player.playbackRate();

							player.on(["playing"], function(e) {
								// can only set a playback rate when the player is actually playing; setting before "playing" has no effect
								player.playbackRate(currentPlaybackRate);
							});

							if(CURRENT_VIDEO_RESOLUTION == null && CURRENT_VIDEO_FORMAT == null) {
								const currentSource = player.currentSrc();
								const segments = currentSource.split('/');
								
								CURRENT_VIDEO_RESOLUTION = segments[segments.length - 1];
								CURRENT_VIDEO_FORMAT = segments[segments.length - 2];
								
								if(CURRENT_VIDEO_FORMAT !== 'mp4' && CURRENT_VIDEO_FORMAT !== 'webm' && CURRENT_VIDEO_FORMAT !== 'ogv') {
									CURRENT_VIDEO_FORMAT = 'm3u8';
									CURRENT_VIDEO_RESOLUTION = 'auto';
								}
							}

							showOverflowMenuMain();

							function showOverflowMenuMain() {
								const html = '\
								<div class="video-js-overflow-menu">\
									<button type="button" class="video-js-overflow-format-button"><label class="video-js-overflow-button-label"><span>Quality</span><span class="video-js-current-selection-span">' + CURRENT_VIDEO_FORMAT + ' ' + CURRENT_VIDEO_RESOLUTION + MATERIAL_NAVIGATE_NEXT_SVG + '</span></label></button>\
									<button type="button" class="video-js-overflow-playback-speed-button"><label class="video-js-overflow-button-label"><span>Playback speed</span><span class="video-js-current-selection-span">' + currentPlaybackRate + 'x' + MATERIAL_NAVIGATE_NEXT_SVG + '</span></label></button>\
								</div>';
								
								if($("#video-player .vjs-control-bar .video-js-overflow-menu").length) {
									$("#video-player .vjs-control-bar .video-js-overflow-menu").replaceWith(html);
								}
								else {
									$("#video-player .vjs-control-bar").append(html);
								}
								
								$('#video-player .vjs-control-bar .video-js-overflow-menu .video-js-overflow-format-button').click(function(event) {
									event.stopPropagation();

									showOverflowMenuFormats();
								});

								$('#video-player .vjs-control-bar .video-js-overflow-menu .video-js-overflow-playback-speed-button').click(function(event) {
									event.stopPropagation();

									showPlayRateMenu();
								});
							}

							function showOverflowMenuFormats() {
								// find the (available) formats that actually have sources; not empty array
								const availableFormats = Object.keys(sourcesFormatsAndResolutions).filter(key => Array.isArray(sourcesFormatsAndResolutions[key]) && sourcesFormatsAndResolutions[key].length > 0);

								let html = '<div class="video-js-overflow-menu">\
								<button type="button" class="video-js-back-to-overflow-main-button"><span>Format</span>' + MATERIAL_NAVIGATE_BEFORE_SVG + '</button>';

								availableFormats.forEach(function(availableFormat) {
									if(CURRENT_VIDEO_FORMAT === availableFormat) {
										html += '<button type="button" class="video-js-overflow-format-explicit-button video-js-overflow-explicit-selected-button" data-format="' + availableFormat + '"><span class="video-js-chosen-item">' + MATERIAL_DONE_SVG + '</span><span>' + availableFormat + '</span></button>';
									}
									else {
										html += '<button type="button" class="video-js-overflow-format-explicit-button" data-format="' + availableFormat + '"><span class="video-js-chosen-item hidden-elem">' + MATERIAL_DONE_SVG + '</span><span>' + availableFormat + '</span></button>';
									}
								});

								html += '</div>';

								$("#video-player .vjs-control-bar .video-js-overflow-menu").replaceWith(html);
								
								$('#video-player .vjs-control-bar .video-js-overflow-menu .video-js-overflow-format-explicit-button').click(function(event) {
									event.stopPropagation();

									const selectedVideoFormat = $(this).data('format');

									showOverflowMenuResolutions(selectedVideoFormat);
								});

								// back from formats menu to main menu
								$('.video-js-back-to-overflow-main-button').click(function(event) {
									event.stopPropagation();
									
									showOverflowMenuMain();
								});
							}

							function showOverflowMenuResolutions(selectedVideoFormat) {
								const resolutions = sourcesFormatsAndResolutions[selectedVideoFormat];

								let html = '<div class="video-js-overflow-menu">\
								<button type="button" class="video-js-back-to-overflow-formats-button"><span>Resolution</span>' + MATERIAL_NAVIGATE_BEFORE_SVG + '</button>';
								
								resolutions.forEach(function(resolution) {
									if(selectedVideoFormat === CURRENT_VIDEO_FORMAT && CURRENT_VIDEO_RESOLUTION === resolution) {
										html += '<button type="button" class="video-js-overflow-format-resolution-explicit-button video-js-overflow-explicit-selected-button" data-resolution="' + resolution + '"><span class="video-js-chosen-item">' + MATERIAL_DONE_SVG + '</span><span>' + resolution + '</span></button>';
									}
									else {
										html += '<button type="button" class="video-js-overflow-format-resolution-explicit-button" data-resolution="' + resolution + '"><span class="video-js-chosen-item hidden-elem">' + MATERIAL_DONE_SVG + '</span><span>' + resolution + '</span></button>';
									}
								});

								if(selectedVideoFormat === 'm3u8') {
									if(CURRENT_VIDEO_RESOLUTION === 'auto') {
										html += '<button type="button" class="video-js-overflow-format-resolution-explicit-button video-js-overflow-explicit-selected-button" data-resolution="auto"><span class="video-js-chosen-item">' + MATERIAL_DONE_SVG + '</span><span>auto</span></button>';
									}
									else {
										html += '<button type="button" class="video-js-overflow-format-resolution-explicit-button" data-resolution="auto"><span class="video-js-chosen-item hidden-elem">' + MATERIAL_DONE_SVG + '</span><span>auto</span></button>';
									}
								}
								
								html += '</div>';
								
								$("#video-player .vjs-control-bar .video-js-overflow-menu").replaceWith(html);

								// back from resolutions menu to formats menu
								$('.video-js-back-to-overflow-formats-button').click(function(event) {
									event.stopPropagation();
									
									showOverflowMenuFormats();
								});

								$('#video-player .vjs-control-bar .video-js-overflow-menu .video-js-overflow-format-resolution-explicit-button').click(function(event) {
									event.stopPropagation();
									
									CURRENT_VIDEO_FORMAT = selectedVideoFormat;
									CURRENT_VIDEO_RESOLUTION = $(this).data('resolution');
									
									$('#video-player .vjs-control-bar .video-js-overflow-menu .video-js-overflow-format-resolution-explicit-button .video-js-chosen-item').addClass('hidden-elem');
									$('#video-player .vjs-control-bar .video-js-overflow-menu .video-js-overflow-format-resolution-explicit-button').removeClass('video-js-overflow-explicit-selected-button');
									
									$(this).addClass('video-js-overflow-explicit-selected-button');
									$(this).find('.video-js-chosen-item').removeClass('hidden-elem');

									let source;

									if(CURRENT_VIDEO_FORMAT === 'm3u8') {
										if(CURRENT_VIDEO_RESOLUTION === 'auto') {
											source = { src: adaptiveSources[0].src, type: adaptiveSources[0].type };
										}
										else {
											for(const adaptiveSource of adaptiveSources) {
												const segments = adaptiveSource.src.split('/');
												const adaptiveSourceResolution = segments[segments.length - 1];

												if(adaptiveSourceResolution === ('manifest-' + CURRENT_VIDEO_RESOLUTION + '.' + CURRENT_VIDEO_FORMAT)) {
													source = { src: adaptiveSource.src, type: adaptiveSource.type };
												}
											}
										}
									}
									else {
										for(const progressiveSource of progressiveSources) {
											const segments = progressiveSource.src.split('/');

											const progressiveSourceResolution = segments[segments.length - 1];
											const progressiveSourceFormat = segments[segments.length - 2];

											if(CURRENT_VIDEO_RESOLUTION === progressiveSourceResolution && CURRENT_VIDEO_FORMAT === progressiveSourceFormat) {
												source = { src: progressiveSource.src, type: progressiveSource.type };
											}
										}
									}

									const currentTime = player.currentTime();

									player.src(source);
									player.currentTime(currentTime);

									player.play()
									.then(function() {
										// do nothing
									})
									.catch(function(error) {
										console.log(error);
									});
								});
							}

							function showPlayRateMenu() {
								const playbackRates = [0.25, 0.5, 0.75, 1.0, 1.25, 1.5, 1.75, 2.0];
								
								let html = '<div class="video-js-overflow-menu">\
								<button type="button" class="video-js-back-to-overflow-main-button"><span>Playback speed</span>' + MATERIAL_NAVIGATE_BEFORE_SVG + '</button>';
								
								playbackRates.forEach(function(playbackRate) {
									if(playbackRate === currentPlaybackRate) {
										html += '<button type="button" class="video-js-overflow-explicit-button video-js-overflow-explicit-selected-button" data-playbackrate="' + playbackRate + '"><span class="video-js-chosen-item">' + MATERIAL_DONE_SVG + '</span><span>' + playbackRate + '</span></button>';
									}
									else {
										html += '<button type="button" class="video-js-overflow-explicit-button" data-playbackrate="' + playbackRate + '"><span class="video-js-chosen-item hidden-elem">' + MATERIAL_DONE_SVG + '</span><span>' + playbackRate + '</span></button>';
									}
								});
								
								html += '</div>';
								
								$("#video-player .vjs-control-bar .video-js-overflow-menu").replaceWith(html);
								
								$('#video-player .vjs-control-bar .video-js-overflow-menu .video-js-overflow-explicit-button').click(function(event) {
									event.stopPropagation();
									
									const selectedPlaybackRate = $(this).data('playbackrate');
									
									$('#video-player .vjs-control-bar .video-js-overflow-menu .video-js-overflow-explicit-button .video-js-chosen-item').addClass('hidden-elem');
									$('#video-player .vjs-control-bar .video-js-overflow-menu .video-js-overflow-explicit-button').removeClass('video-js-overflow-explicit-selected-button');
									
									$(this).addClass('video-js-overflow-explicit-selected-button');
									$(this).find('.video-js-chosen-item').removeClass('hidden-elem');
									
									player.playbackRate(selectedPlaybackRate);
								});
								
								$('.video-js-back-to-overflow-main-button').click(function(event) {
									event.stopPropagation();

									showOverflowMenuMain();
								});
							}
						}
						
						function removeOverflowMenuHtml() {
							$('#video-player .vjs-control-bar .video-js-overflow-menu').remove();
						}
					}

					function configurePlayerEvents() {
						player.on(["loadstart", "firstplay", "pause", "ended", "adplay", "adplaying", "adfirstplay", "adpause", "adended", "contentplay", "contentplaying", "contentfirstplay", "contentpause", "contentended", "contentupdate"], function(e) {
							//console.log(e);
						});
						
						player.on(["pause"], function(e) {
							//console.log(e);						
						});

						player.on("loadedmetadata", function() { 
							console.log("metadata loaded");
						});
						
						player.on(["playing"], function(e) {
							console.log('playing');

							$('#mtp-video-overlay').remove();
						});

						player.on("waiting", function() { 
							console.log('waiting');
						});

						player.on("ready", function() { 
							console.log('ready');
						});
						
						$('#mtp-channel-link').click(function(event) {
							event.stopPropagation();
						});
						
						$('#mtp-video-link').click(function(event) {
							event.stopPropagation();
						});
						
						let bigPlayButtonClicked = false;

						$('.mtp-video-overlay-child').click(function(event) {
							bigPlayButtonClicked = true;

							$('#mtp-video-overlay').remove();
							
							player.src(sources);
							player.play()
							.then(function() {
							
							})
							.catch(function(error) {
								console.log(error);
							});
						});
						
						$('#watch-on-moartube-mtp-overlay-child').click(function(event) {
							event.stopPropagation();
						});

						$('#video-player-container').mouseenter(function() {
							$('#mtp-video-overlay-info').removeClass('mtp-video-overlay-info-fade-out');
							$('#mtp-video-overlay-info').addClass('mtp-video-overlay-info-fade-in');
						});
						
						$('#video-player-container').mouseleave(function() {
							$('#mtp-video-overlay-info').removeClass('mtp-video-overlay-info-fade-in');
							$('#mtp-video-overlay-info').addClass('mtp-video-overlay-info-fade-out');
						});
					}

					function configurePlayerContextMenu() {
						player.el().addEventListener('contextmenu', function(event) {
							event.preventDefault();

							showCustomContextMenu(event.pageX, event.pageY);
						}, false);

						function showCustomContextMenu(x, y) {
							let menu = $('#video-player-context-menu');

							if ($(menu).length === 0) {
								menu = $('<div id="video-player-context-menu" class="list-group"></div>');

								$(menu).append('<a id="copy-video-url" class="list-group-item list-group-item-action p-1 hand bg-dark text-light">copy video url</a>');

								if(!isStreaming) {
									$(menu).append('<a id="copy-video-url-at-current-time" class="list-group-item list-group-item-action p-1 hand bg-dark text-light">copy video url at current time</a>');
								}

								$(menu).css({
									position: 'absolute'
								});

								$(menu).appendTo('body');

								$('#copy-video-url').click(function(event) {
									event.stopPropagation();

									const videoUrl = window.location.origin + '/watch?v=' + VIDEO_ID;
									setClipboard(videoUrl);

									$(menu).remove();
								});

								$('#copy-video-url-at-current-time').click(function(event) {
									event.stopPropagation();

									const videoUrlAtCurrentTime = window.location.origin + '/watch?v=' + VIDEO_ID + '&t=' + Math.floor(player.currentTime());
									setClipboard(videoUrlAtCurrentTime);

									$(menu).remove();
								});
							}

							$(menu).css({
								left: x + 'px',
								top: y + 'px',
								display: 'block'
							});

							$(document).click(function() {
								$(menu).remove();
							});
						}
					}
				}
			}

			function setClipboard(value) {
				try {
					navigator.clipboard.writeText(value)
					.then(function() {
						// text copied to clipboard success
					})
					.catch(function(error) {
						// text copied to clipboard fail, so using native DOM API fallback
						
						fallback(value);
					});
				}
				catch(error) {
					// text copied to clipboard fail, so using native DOM API fallback
					
					fallback(value);
				}
				
				function fallback() {
					let tempInput = document.createElement("input");
					tempInput.style = "position: absolute; left: -1000px; top: -1000px";
					tempInput.value = value;
					document.body.appendChild(tempInput);
					tempInput.select();
					document.execCommand("copy");
					document.body.removeChild(tempInput);
				}
			}
		</script>
	</body>
</html>